const canvas=document.getElementById("canvas"),canvasContext=canvas.getContext("2d"),pacmanFrames=document.getElementById("animation"),ghostFrames=document.getElementById("ghosts");let createRect=(a,b,c,d,e)=>{canvasContext.fillStyle=e,canvasContext.fillRect(a,b,c,d)};const DIRECTION_RIGHT=4,DIRECTION_UP=3,DIRECTION_LEFT=2,DIRECTION_BOTTOM=1;let pacman,lives=3,ghostCount=4,ghostImageLocations=[{x:0,y:0},{x:176,y:0},{x:0,y:121},{x:176,y:121}],fps=30,oneBlockSize=20,score=0,ghosts=[],wallSpaceWidth=oneBlockSize/1.6,wallOffset=(oneBlockSize-wallSpaceWidth)/2,wallInnerColor="black",map=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1],[1,2,1,1,1,2,1,1,1,2,1,2,1,1,1,2,1,1,1,2,1],[1,2,1,1,1,2,1,1,1,2,1,2,1,1,1,2,1,1,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,1,1,2,1,2,1,1,1,1,1,2,1,2,1,1,1,2,1],[1,2,2,2,2,2,1,2,2,2,1,2,2,2,1,2,2,2,2,2,1],[1,1,1,1,1,2,1,1,1,2,1,2,1,1,1,2,1,1,1,1,1],[0,0,0,0,1,2,1,2,2,2,2,2,2,2,1,2,1,0,0,0,0],[1,1,1,1,1,2,1,2,1,1,2,1,1,2,1,2,1,1,1,1,1],[1,2,2,2,2,2,2,2,1,2,2,2,1,2,2,2,2,2,2,2,2],[1,1,1,1,1,2,1,2,1,2,2,2,1,2,1,2,1,1,1,1,1],[0,0,0,0,1,2,1,2,1,1,1,1,1,2,1,2,1,0,0,0,0],[0,0,0,0,1,2,1,2,2,2,2,2,2,2,1,2,1,0,0,0,0],[1,1,1,1,1,2,2,2,1,1,1,1,1,2,2,2,1,1,1,1,1],[1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1],[1,2,1,1,1,2,1,1,1,2,1,2,1,1,1,2,1,1,1,2,1],[1,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,1],[1,1,2,2,1,2,1,2,1,1,1,1,1,2,1,2,1,2,2,1,1],[1,2,2,2,2,2,1,2,2,2,1,2,2,2,1,2,2,2,2,2,1],[1,2,1,1,1,1,1,1,1,2,1,2,1,1,1,1,1,1,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],randomTargetsForGhosts=[{x:1*oneBlockSize,y:1*oneBlockSize},{x:1*oneBlockSize,y:(map.length-2)*oneBlockSize},{x:(map[0].length-2)*oneBlockSize,y:oneBlockSize},{x:(map[0].length-2)*oneBlockSize,y:(map.length-2)*oneBlockSize}],createNewPacman=()=>{pacman=new Pacman(oneBlockSize,oneBlockSize,oneBlockSize,oneBlockSize,oneBlockSize/5)},gameLoop=()=>{update(),draw()},gameInterval=setInterval(gameLoop,1e3/fps),restartPacmanAndGhosts=()=>{createNewPacman(),createGhosts()},onGhostCollision=()=>{lives--,restartPacmanAndGhosts(),0==lives},update=()=>{pacman.moveProcess(),pacman.eat(),updateGhosts(),pacman.checkGhostCollision(ghosts)&&onGhostCollision()},drawFoods=()=>{for(let a=0;a<map.length;a++)for(let b=0;b<map[0].length;b++)2==map[a][b]&&createRect(b*oneBlockSize+oneBlockSize/3,a*oneBlockSize+oneBlockSize/3,oneBlockSize/3,oneBlockSize/3,"#FEB897")},drawRemainingLives=()=>{canvasContext.font="20px Emulogic",canvasContext.fillStyle="white",canvasContext.fillText("Lives: ",220,oneBlockSize*(map.length+1));for(let a=0;a<lives;a++)canvasContext.drawImage(pacmanFrames,2*oneBlockSize,0,oneBlockSize,oneBlockSize,350+a*oneBlockSize,oneBlockSize*map.length+2,oneBlockSize,oneBlockSize)},drawScore=()=>{canvasContext.font="20px Emulogic",canvasContext.fillStyle="white",canvasContext.fillText("Score: "+score,0,oneBlockSize*(map.length+1))},draw=()=>{canvasContext.clearRect(0,0,canvas.width,canvas.height),createRect(0,0,canvas.width,canvas.height,"black"),drawWalls(),drawFoods(),drawGhosts(),pacman.draw(),drawScore(),drawRemainingLives()},drawWalls=()=>{for(let a=0;a<map.length;a++)for(let b=0;b<map[0].length;b++)1==map[a][b]&&(createRect(b*oneBlockSize,a*oneBlockSize,oneBlockSize,oneBlockSize,"#342DCA"),0<b&&1==map[a][b-1]&&createRect(b*oneBlockSize,a*oneBlockSize+wallOffset,wallSpaceWidth+wallOffset,wallSpaceWidth,wallInnerColor),b<map[0].length-1&&1==map[a][b+1]&&createRect(b*oneBlockSize+wallOffset,a*oneBlockSize+wallOffset,wallSpaceWidth+wallOffset,wallSpaceWidth,wallInnerColor),a<map.length-1&&1==map[a+1][b]&&createRect(b*oneBlockSize+wallOffset,a*oneBlockSize+wallOffset,wallSpaceWidth,wallSpaceWidth+wallOffset,wallInnerColor),0<a&&1==map[a-1][b]&&createRect(b*oneBlockSize+wallOffset,a*oneBlockSize,wallSpaceWidth,wallSpaceWidth+wallOffset,wallInnerColor))},createGhosts=()=>{ghosts=[];for(let a,b=0;b<2*ghostCount;b++)a=new Ghost(9*oneBlockSize+(0==b%2?0:1)*oneBlockSize,10*oneBlockSize+(0==b%2?0:1)*oneBlockSize,oneBlockSize,oneBlockSize,pacman.speed/2,ghostImageLocations[b%4].x,ghostImageLocations[b%4].y,124,116,6+b),ghosts.push(a)};createNewPacman(),createGhosts(),gameLoop(),window.addEventListener("keydown",a=>{let b=a.keyCode;setTimeout(()=>{37==b||65==b?pacman.nextDirection=DIRECTION_LEFT:38==b||87==b?pacman.nextDirection=DIRECTION_UP:39==b||68==b?pacman.nextDirection=DIRECTION_RIGHT:(40==b||83==b)&&(pacman.nextDirection=DIRECTION_BOTTOM)},1)});